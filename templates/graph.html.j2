<canvas id="myChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/locale/fr.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8/hammer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@0.7.7/dist/chartjs-plugin-zoom.min.js"></script>
<script src="/static/chart.js"></script>

<script>
  const ctx = document.getElementById("myChart");
  fetch("{{ url_for('api.journal', meter_id=model.meter_id) }}")
  .then((res) => res.json())
  .then((json) => groupByYear(json))
  //.then((json) => formatForChart(json)).then((res) => console.log(res))
  .then((journal) => buildChart(ctx, journal))
  //.catch((err)=>console.log(err))


  //const demo = {'days': 15, 'entries': [{'date': 'Tue, 13 Nov 2018 00:00:00 GMT', 'id': 1, 'mean_consumption_per_day': 0.0, 'value': 5146.0}, {'date': 'Sat, 17 Nov 2018 00:00:00 GMT', 'id': 2, 'mean_consumption_per_day': 13.0, 'value': 5198.0}, {'date': 'Sun, 18 Nov 2018 00:00:00 GMT', 'id': 3, 'mean_consumption_per_day': 10.0, 'value': 5208.0}, {'date': 'Tue, 20 Nov 2018 00:00:00 GMT', 'id': 4, 'mean_consumption_per_day': 11.5, 'value': 5231.0}, {'date': 'Sat, 24 Nov 2018 00:00:00 GMT', 'id': 5, 'mean_consumption_per_day': 7.5, 'value': 5261.0}, {'date': 'Fri, 07 Dec 2018 00:00:00 GMT', 'id': 6, 'mean_consumption_per_day': 10.0, 'value': 5391.0}, {'date': 'Sun, 09 Dec 2018 00:00:00 GMT', 'id': 7, 'mean_consumption_per_day': 8.5, 'value': 5408.0}, {'date': 'Wed, 19 Dec 2018 00:00:00 GMT', 'id': 8, 'mean_consumption_per_day': 8.3, 'value': 5491.0}, {'date': 'Thu, 27 Dec 2018 00:00:00 GMT', 'id': 9, 'mean_consumption_per_day': 8.5, 'value': 5559.0}, {'date': 'Fri, 11 Jan 2019 00:00:00 GMT', 'id': 10, 'mean_consumption_per_day': 11.33, 'value': 5729.0}, {'date': 'Sat, 26 Jan 2019 00:00:00 GMT', 'id': 11, 'mean_consumption_per_day': 10.6, 'value': 5888.0}, {'date': 'Fri, 08 Feb 2019 00:00:00 GMT', 'id': 12, 'mean_consumption_per_day': 9.77, 'value': 6015.0}, {'date': 'Mon, 18 Feb 2019 00:00:00 GMT', 'id': 13, 'mean_consumption_per_day': 7.3, 'value': 6088.0}, {'date': 'Wed, 20 Feb 2019 00:00:00 GMT', 'id': 14, 'mean_consumption_per_day': 3.5, 'value': 6095.0}, {'date': 'Sat, 23 Feb 2019 00:00:00 GMT', 'id': 15, 'mean_consumption_per_day': 6.0, 'value': 6113.0}, {'date': 'Wed, 27 Feb 2019 00:00:00 GMT', 'id': 16, 'mean_consumption_per_day': 2.25, 'value': 6122.0}, {'date': 'Fri, 08 Mar 2019 00:00:00 GMT', 'id': 17, 'mean_consumption_per_day': 8.78, 'value': 6201.0}, {'date': 'Wed, 20 Mar 2019 00:00:00 GMT', 'id': 18, 'mean_consumption_per_day': 7.58, 'value': 6292.0}, {'date': 'Sat, 23 Mar 2019 00:00:00 GMT', 'id': 19, 'mean_consumption_per_day': 4.67, 'value': 6306.0}, {'date': 'Sat, 30 Mar 2019 00:00:00 GMT', 'id': 20, 'mean_consumption_per_day': 5.71, 'value': 6346.0}, {'date': 'Sun, 31 Mar 2019 00:00:00 GMT', 'id': 21, 'mean_consumption_per_day': 3.0, 'value': 6349.0}, {'date': 'Sun, 07 Apr 2019 00:00:00 GMT', 'id': 22, 'mean_consumption_per_day': 5.14, 'value': 6385.0}, {'date': 'Wed, 10 Apr 2019 00:00:00 GMT', 'id': 23, 'mean_consumption_per_day': 4.67, 'value': 6399.0}, {'date': 'Sat, 13 Apr 2019 00:00:00 GMT', 'id': 24, 'mean_consumption_per_day': 1.67, 'value': 6404.0}, {'date': 'Thu, 18 Apr 2019 00:00:00 GMT', 'id': 25, 'mean_consumption_per_day': 5.2, 'value': 6430.0}, {'date': 'Fri, 26 Apr 2019 00:00:00 GMT', 'id': 26, 'mean_consumption_per_day': 1.88, 'value': 6445.0}, {'date': 'Sat, 04 May 2019 00:00:00 GMT', 'id': 27, 'mean_consumption_per_day': 3.88, 'value': 6476.0}, {'date': 'Wed, 08 May 2019 00:00:00 GMT', 'id': 28, 'mean_consumption_per_day': 5.75, 'value': 6499.0}, {'date': 'Wed, 15 May 2019 00:00:00 GMT', 'id': 29, 'mean_consumption_per_day': 3.0, 'value': 6520.0}, {'date': 'Wed, 22 May 2019 00:00:00 GMT', 'id': 30, 'mean_consumption_per_day': 4.14, 'value': 6549.0}, {'date': 'Sun, 02 Jun 2019 00:00:00 GMT', 'id': 31, 'mean_consumption_per_day': 2.82, 'value': 6580.0}, {'date': 'Thu, 06 Jun 2019 00:00:00 GMT', 'id': 32, 'mean_consumption_per_day': -1.5, 'value': 6574.0}, {'date': 'Sat, 08 Jun 2019 00:00:00 GMT', 'id': 34, 'mean_consumption_per_day': 8.0, 'value': 6590.0}, {'date': 'Thu, 13 Jun 2019 00:00:00 GMT', 'id': 35, 'mean_consumption_per_day': 0.8, 'value': 6594.0}, {'date': 'Tue, 18 Jun 2019 00:00:00 GMT', 'id': 36, 'mean_consumption_per_day': 1.6, 'value': 6602.0}, {'date': 'Mon, 24 Jun 2019 00:00:00 GMT', 'id': 37, 'mean_consumption_per_day': 0.0, 'value': 6602.0}, {'date': 'Sun, 30 Jun 2019 00:00:00 GMT', 'id': 70, 'mean_consumption_per_day': -2.0, 'value': 6590.0}, {'date': 'Wed, 03 Jul 2019 00:00:00 GMT', 'id': 71, 'mean_consumption_per_day': -3.0, 'value': 6581.0}, {'date': 'Sat, 06 Jul 2019 00:00:00 GMT', 'id': 72, 'mean_consumption_per_day': 0.33, 'value': 6582.0}, {'date': 'Fri, 12 Jul 2019 00:00:00 GMT', 'id': 73, 'mean_consumption_per_day': 0.5, 'value': 6585.0}, {'date': 'Wed, 17 Jul 2019 00:00:00 GMT', 'id': 74, 'mean_consumption_per_day': 3.4, 'value': 6602.0}, {'date': 'Tue, 06 Aug 2019 00:00:00 GMT', 'id': 75, 'mean_consumption_per_day': 1.7, 'value': 6636.0}, {'date': 'Fri, 23 Aug 2019 00:00:00 GMT', 'id': 76, 'mean_consumption_per_day': 3.82, 'value': 6701.0}, {'date': 'Fri, 20 Sep 2019 00:00:00 GMT', 'id': 77, 'mean_consumption_per_day': 5.25, 'value': 6848.0}, {'date': 'Sat, 28 Sep 2019 00:00:00 GMT', 'id': 78, 'mean_consumption_per_day': 8.38, 'value': 6915.0}, {'date': 'Tue, 22 Oct 2019 00:00:00 GMT', 'id': 79, 'mean_consumption_per_day': 11.71, 'value': 7196.0}, {'date': 'Tue, 19 Nov 2019 00:00:00 GMT', 'id': 80, 'mean_consumption_per_day': 13.14, 'value': 7564.0}, {'date': 'Fri, 06 Dec 2019 00:00:00 GMT', 'id': 81, 'mean_consumption_per_day': 16.12, 'value': 7838.0}, {'date': 'Mon, 30 Dec 2019 00:00:00 GMT', 'id': 82, 'mean_consumption_per_day': 16.08, 'value': 8224.0}, {'date': 'Wed, 08 Jan 2020 00:00:00 GMT', 'id': 83, 'mean_consumption_per_day': 12.0, 'value': 8332.0}, {'date': 'Tue, 21 Jan 2020 00:00:00 GMT', 'id': 116, 'mean_consumption_per_day': 11.08, 'value': 8476.0}, {'date': 'Tue, 04 Feb 2020 00:00:00 GMT', 'id': 117, 'mean_consumption_per_day': 11.57, 'value': 8638.0}, {'date': 'Tue, 18 Feb 2020 00:00:00 GMT', 'id': 118, 'mean_consumption_per_day': 12.07, 'value': 8807.0}, {'date': 'Wed, 26 Feb 2020 00:00:00 GMT', 'id': 119, 'mean_consumption_per_day': 10.62, 'value': 8892.0}, {'date': 'Sun, 01 Mar 2020 00:00:00 GMT', 'id': 120, 'mean_consumption_per_day': 12.75, 'value': 8943.0}, {'date': 'Sun, 15 Mar 2020 00:00:00 GMT', 'id': 121, 'mean_consumption_per_day': 12.93, 'value': 9124.0}, {'date': 'Sun, 05 Apr 2020 00:00:00 GMT', 'id': 122, 'mean_consumption_per_day': 12.33, 'value': 9383.0}, {'date': 'Thu, 16 Apr 2020 00:00:00 GMT', 'id': 123, 'mean_consumption_per_day': 10.73, 'value': 9501.0}, {'date': 'Fri, 24 Apr 2020 00:00:00 GMT', 'id': 124, 'mean_consumption_per_day': 15.12, 'value': 9622.0}, {'date': 'Sun, 26 Apr 2020 00:00:00 GMT', 'id': 125, 'mean_consumption_per_day': 11.5, 'value': 9645.0}, {'date': 'Tue, 28 Apr 2020 00:00:00 GMT', 'id': 126, 'mean_consumption_per_day': 2.0, 'value': 9649.0}, {'date': 'Sun, 03 May 2020 00:00:00 GMT', 'id': 127, 'mean_consumption_per_day': 9.0, 'value': 9694.0}, {'date': 'Thu, 07 May 2020 00:00:00 GMT', 'id': 128, 'mean_consumption_per_day': 5.5, 'value': 9716.0}, {'date': 'Wed, 13 May 2020 00:00:00 GMT', 'id': 129, 'mean_consumption_per_day': 5.17, 'value': 9747.0}, {'date': 'Tue, 19 May 2020 00:00:00 GMT', 'id': 130, 'mean_consumption_per_day': 4.0, 'value': 9771.0}, {'date': 'Sun, 24 May 2020 00:00:00 GMT', 'id': 131, 'mean_consumption_per_day': 4.8, 'value': 9795.0}, {'date': 'Sun, 31 May 2020 00:00:00 GMT', 'id': 132, 'mean_consumption_per_day': 2.71, 'value': 9814.0}, {'date': 'Thu, 11 Jun 2020 00:00:00 GMT', 'id': 133, 'mean_consumption_per_day': 7.27, 'value': 9894.0}, {'date': 'Tue, 16 Jun 2020 00:00:00 GMT', 'id': 134, 'mean_consumption_per_day': 6.0, 'value': 9924.0}, {'date': 'Thu, 16 Jul 2020 00:00:00 GMT', 'id': 135, 'mean_consumption_per_day': 6.7, 'value': 10125.0}, {'date': 'Tue, 21 Jul 2020 00:00:00 GMT', 'id': 136, 'mean_consumption_per_day': 4.0, 'value': 10145.0}, {'date': 'Sat, 25 Jul 2020 00:00:00 GMT', 'id': 137, 'mean_consumption_per_day': -2.5, 'value': 10135.0}, {'date': 'Mon, 03 Aug 2020 00:00:00 GMT', 'id': 138, 'mean_consumption_per_day': 4.11, 'value': 10172.0}, {'date': 'Mon, 24 Aug 2020 00:00:00 GMT', 'id': 139, 'mean_consumption_per_day': 6.05, 'value': 10299.0}, {'date': 'Sat, 17 Oct 2020 00:00:00 GMT', 'id': 140, 'mean_consumption_per_day': 11.09, 'value': 10898.0}, {'date': 'Mon, 30 Nov 2020 00:00:00 GMT', 'id': 141, 'mean_consumption_per_day': 13.34, 'value': 11485.0}, {'date': 'Tue, 15 Dec 2020 00:00:00 GMT', 'id': 142, 'mean_consumption_per_day': 16.87, 'value': 11738.0}], 'mean': 6.83, 'trend_last_days': '147.00 %'};
</script>
